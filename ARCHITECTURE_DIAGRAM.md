# GraphCanvas Architecture Diagram

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          /graph Page (page.tsx)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  State Management:                                                     â”‚  â”‚
â”‚  â”‚  - commandMenuOpen: boolean                                            â”‚  â”‚
â”‚  â”‚  - activeGraphs: string[]                                              â”‚  â”‚
â”‚  â”‚  - error: string | null                                                â”‚  â”‚
â”‚  â”‚  - currentGraphId: string | null (first active graph)                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚   CommandMenu FAB   â”‚â”€â”€â”€â”€â–¶â”‚   CommandMenu        â”‚                       â”‚
â”‚  â”‚   (BrainCircuit)    â”‚     â”‚   - Search graphs    â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   - Create graph     â”‚                       â”‚
â”‚                               â”‚   - Toggle active    â”‚                       â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                          â”‚                                   â”‚
â”‚                                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        GraphCanvas Component                           â”‚  â”‚
â”‚  â”‚  Props: graphId, onSave, onError, showMinimap, showControls           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚   Error Toast       â”‚     â”‚   Veracity Legend    â”‚                       â”‚
â”‚  â”‚   (auto-dismiss)    â”‚     â”‚   (color scheme)     â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GraphCanvas Internal Flow                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. Query GRAPH_QUERY(graphId)                                        â”‚  â”‚
â”‚  â”‚     â†“                                                                  â”‚  â”‚
â”‚  â”‚  2. Transform backend data to React Flow format                       â”‚  â”‚
â”‚  â”‚     - Parse JSON props                                                 â”‚  â”‚
â”‚  â”‚     - Map node.id â†’ FlowNode                                          â”‚  â”‚
â”‚  â”‚     - Map edge.from/to â†’ FlowEdge source/target                       â”‚  â”‚
â”‚  â”‚     â†“                                                                  â”‚  â”‚
â”‚  â”‚  3. Initialize React Flow state                                       â”‚  â”‚
â”‚  â”‚     - nodes: GraphCanvasNode[]                                         â”‚  â”‚
â”‚  â”‚     - edges: GraphCanvasEdge[]                                         â”‚  â”‚
â”‚  â”‚     - history: HistoryItem[]                                           â”‚  â”‚
â”‚  â”‚     â†“                                                                  â”‚  â”‚
â”‚  â”‚  4. Render React Flow with custom components                          â”‚  â”‚
â”‚  â”‚     - nodeTypes: { custom: GraphNode }                                â”‚  â”‚
â”‚  â”‚     - edgeTypes: { custom: GraphEdge }                                â”‚  â”‚
â”‚  â”‚     â†“                                                                  â”‚  â”‚
â”‚  â”‚  5. Subscribe to real-time updates                                    â”‚  â”‚
â”‚  â”‚     - NODE_CREATED, NODE_UPDATED, NODE_DELETED                        â”‚  â”‚
â”‚  â”‚     - EDGE_CREATED, EDGE_UPDATED, EDGE_DELETED                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Component Hierarchy                                â”‚
â”‚                                                                               â”‚
â”‚  GraphCanvas (ReactFlowProvider wrapper)                                     â”‚
â”‚    â”‚                                                                          â”‚
â”‚    â”œâ”€â–¶ ReactFlow                                                             â”‚
â”‚    â”‚    â”‚                                                                     â”‚
â”‚    â”‚    â”œâ”€â–¶ GraphNode (custom node type)                                     â”‚
â”‚    â”‚    â”‚    â”œâ”€ Veracity color background                                    â”‚
â”‚    â”‚    â”‚    â”œâ”€ Lock icon (if Level 0)                                       â”‚
â”‚    â”‚    â”‚    â”œâ”€ Node label                                                   â”‚
â”‚    â”‚    â”‚    â”œâ”€ Veracity badge                                               â”‚
â”‚    â”‚    â”‚    â””â”€ Connection handles                                           â”‚
â”‚    â”‚    â”‚                                                                     â”‚
â”‚    â”‚    â”œâ”€â–¶ GraphEdge (custom edge type)                                     â”‚
â”‚    â”‚    â”‚    â”œâ”€ Veracity color stroke                                        â”‚
â”‚    â”‚    â”‚    â”œâ”€ Lock icon label (if Level 0)                                 â”‚
â”‚    â”‚    â”‚    â”œâ”€ Edge label with %                                            â”‚
â”‚    â”‚    â”‚    â””â”€ Animated dash (if low confidence)                            â”‚
â”‚    â”‚    â”‚                                                                     â”‚
â”‚    â”‚    â”œâ”€â–¶ Controls (zoom, fit, lock)                                       â”‚
â”‚    â”‚    â”œâ”€â–¶ MiniMap (with veracity colors)                                   â”‚
â”‚    â”‚    â””â”€â–¶ Background (dots grid)                                           â”‚
â”‚    â”‚                                                                          â”‚
â”‚    â””â”€â–¶ ContextMenu                                                           â”‚
â”‚         â”œâ”€ Node menu: Edit, Duplicate, Copy, Delete                          â”‚
â”‚         â”œâ”€ Edge menu: Edit, Delete                                           â”‚
â”‚         â””â”€ Canvas menu: Paste                                                â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         GraphQL Data Flow                                    â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   HTTP Transport    â”‚          â”‚   WebSocket (WS)     â”‚                  â”‚
â”‚  â”‚  (queries/mutations)â”‚          â”‚   (subscriptions)    â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚             â”‚                                 â”‚                              â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                           â–¼                                                  â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚              â”‚   Apollo Client (split)     â”‚                                 â”‚
â”‚              â”‚   - InMemoryCache           â”‚                                 â”‚
â”‚              â”‚   - Automatic batching      â”‚                                 â”‚
â”‚              â”‚   - Optimistic updates      â”‚                                 â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                            â”‚                                                 â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚           â–¼                â–¼                â–¼                                â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚    â”‚ Queries  â”‚    â”‚Mutations â”‚    â”‚Subscript.â”‚                             â”‚
â”‚    â”‚          â”‚    â”‚          â”‚    â”‚          â”‚                             â”‚
â”‚    â”‚ GetGraph â”‚    â”‚CreateNodeâ”‚    â”‚NodeUpd'd â”‚                             â”‚
â”‚    â”‚          â”‚    â”‚UpdateNodeâ”‚    â”‚NodeCrea'dâ”‚                             â”‚
â”‚    â”‚          â”‚    â”‚DeleteNodeâ”‚    â”‚NodeDel'd â”‚                             â”‚
â”‚    â”‚          â”‚    â”‚CreateEdgeâ”‚    â”‚EdgeUpd'd â”‚                             â”‚
â”‚    â”‚          â”‚    â”‚UpdateEdgeâ”‚    â”‚EdgeCrea'dâ”‚                             â”‚
â”‚    â”‚          â”‚    â”‚DeleteEdgeâ”‚    â”‚EdgeDel'd â”‚                             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚           â”‚                â”‚                â”‚                                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                            â–¼                                                 â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚              â”‚   Backend GraphQL Server    â”‚                                 â”‚
â”‚              â”‚   (localhost:4000/graphql)  â”‚                                 â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                            â–¼                                                 â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚              â”‚     PostgreSQL Database     â”‚                                 â”‚
â”‚              â”‚   - graphs table            â”‚                                 â”‚
â”‚              â”‚   - nodes table             â”‚                                 â”‚
â”‚              â”‚   - edges table             â”‚                                 â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## User Interaction Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        User Opens /graph Page                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Authenticated?  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â–¼                         â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     No       â”‚        â”‚      Yes      â”‚
         â”‚ Show Sign In â”‚        â”‚   Continue    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ Active Graph Set?  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â–¼                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      No      â”‚        â”‚      Yes       â”‚
                    â”‚ Show Empty   â”‚        â”‚ Load Graph     â”‚
                    â”‚ State + Hint â”‚        â”‚ with Canvas    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                     â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚  User Actions:   â”‚
                                          â”‚  â€¢ Drag nodes    â”‚
                                          â”‚  â€¢ Connect edges â”‚
                                          â”‚  â€¢ Right-click   â”‚
                                          â”‚  â€¢ Delete        â”‚
                                          â”‚  â€¢ Undo/Redo     â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Transformation Pipeline

```
Backend Node Format              â†’    React Flow Node Format
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{                                     {
  id: "uuid-123",                       id: "uuid-123",
  weight: 0.85,                         type: "custom",
  level: 1,                             position: { x: 100, y: 200 },
  props: "{                             data: {
    \"label\":\"My Node\",                label: "My Node",
    \"x\":100,                            weight: 0.85,
    \"y\":200                             level: 1,
  }"                                      isLocked: false,
}                                         methodology: "scientific"
                                        }
                                      }

Backend Edge Format              â†’    React Flow Edge Format
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{                                     {
  id: "uuid-456",                       id: "uuid-456",
  from: { id: "uuid-123" },             source: "uuid-123",
  to: { id: "uuid-789" },               target: "uuid-789",
  weight: 0.7,                          type: "custom",
  level: 1,                             data: {
  props: "{}"                             weight: 0.7,
}                                         level: 1,
                                          isLocked: false
                                        }
                                      }
```

## Real-Time Update Flow

```
User A                          Server                          User B
â”€â”€â”€â”€â”€â”€â”€                         â”€â”€â”€â”€â”€â”€                          â”€â”€â”€â”€â”€â”€
  â”‚                               â”‚                               â”‚
  â”‚ 1. Drag node to new position  â”‚                               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                               â”‚
  â”‚                               â”‚                               â”‚
  â”‚                          2. Save to DB                        â”‚
  â”‚                               â”‚                               â”‚
  â”‚                          3. Broadcast via WS                  â”‚
  â”‚                               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                               â”‚                               â”‚
  â”‚ 4. Optimistic update          â”‚          5. Receive update    â”‚
  â”‚    (instant feedback)         â”‚             (real-time)       â”‚
  â”‚                               â”‚                               â”‚
  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                               â”‚
  â”‚ 6. Confirmation from server   â”‚                               â”‚
  â”‚                               â”‚                               â”‚

Timeline: ~50ms for optimistic, ~200ms for server confirmation
```

## Veracity Color System

```
Weight Range    Color      Hex         Node Visual           Minimap
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€      â”€â”€â”€         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€
1.0 (Level 0)   Green      #10b981     â”â”â”â”â”â”â”â”â”â”â”“          â—
                                       â”ƒ  ğŸ”’ Node â”ƒ          Green
                                       â”ƒ VERIFIED â”ƒ
                                       â”—â”â”â”â”â”â”â”â”â”â”›

0.7 - 0.99      Lime       #84cc16     â”â”â”â”â”â”â”â”â”â”â”“          â—
                                       â”ƒ   Node   â”ƒ          Lime
                                       â”ƒ   85%    â”ƒ
                                       â”—â”â”â”â”â”â”â”â”â”â”›

0.4 - 0.69      Yellow     #eab308     â”â”â”â”â”â”â”â”â”â”â”“          â—
                                       â”ƒ   Node   â”ƒ          Yellow
                                       â”ƒ   55%    â”ƒ
                                       â”—â”â”â”â”â”â”â”â”â”â”›

0.1 - 0.39      Orange     #f97316     â”â”â”â”â”â”â”â”â”â”â”“          â—
                                       â”ƒ   Node   â”ƒ          Orange
                                       â”ƒ   25%    â”ƒ
                                       â”—â”â”â”â”â”â”â”â”â”â”›

0.0 - 0.09      Red        #ef4444     â”â”â”â”â”â”â”â”â”â”â”“          â—
                                       â”ƒ   Node   â”ƒ          Red
                                       â”ƒ    5%    â”ƒ
                                       â”—â”â”â”â”â”â”â”â”â”â”›
```

## Event Handling Matrix

```
Event Type          Level 0 Node    Level 1 Node    Edge        Canvas
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€
Left Click          Select          Select          Select      Deselect
Right Click         Context Menu    Context Menu    Context     Paste Menu
                    (read-only)     (full options)  Menu
Drag                âŒ Locked       âœ“ Move + Save   N/A         Pan
Delete Key          âŒ Disabled     âœ“ Delete        âœ“ Delete    N/A
Connect Handle      âŒ Blocked      âœ“ Create Edge   N/A         N/A
Cmd+C               âœ“ Copy          âœ“ Copy          âœ“ Copy      N/A
Cmd+Z               âœ“ Undo          âœ“ Undo          âœ“ Undo      N/A
Double Click        View Details    Edit            Edit        N/A
```

## Performance Optimization Layers

```
Layer 1: Component Memoization
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GraphNode â†’ React.memo()
GraphEdge â†’ React.memo()
ContextMenu â†’ React.memo()

Layer 2: State Management
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
useState() for local state
useCallback() for event handlers
useMemo() for computed values
History limited to 50 items

Layer 3: Network Optimization
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Debounced position updates (drag end only)
Batched mutations
Subscription filtering by graphId
Apollo Cache normalization

Layer 4: Rendering Optimization
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
React Flow viewport culling
Snap-to-grid reduces calculations
fitView() only on initial load
CSS transforms for smooth animations
```

---

## File Locations

```
/Users/kmk/rabbithole/frontend/src/
â”œâ”€â”€ app/graph/page.tsx                    [UPDATED] Main page
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ GraphCanvas.tsx                   [EXISTING] Canvas component
â”‚   â”œâ”€â”€ GraphNode.tsx                     [EXISTING] Node renderer
â”‚   â”œâ”€â”€ GraphEdge.tsx                     [EXISTING] Edge renderer
â”‚   â”œâ”€â”€ ContextMenu.tsx                   [EXISTING] Context menu
â”‚   â””â”€â”€ CommandMenu.tsx                   [EXISTING] Graph selector
â”œâ”€â”€ graphql/queries/graphs.ts             [EXISTING] GraphQL operations
â”œâ”€â”€ lib/apollo-client.ts                  [EXISTING] Apollo setup
â”œâ”€â”€ types/graph.ts                        [EXISTING] TypeScript types
â””â”€â”€ styles/
    â”œâ”€â”€ theme.ts                          [EXISTING] Theme config
    â””â”€â”€ graph-canvas.css                  [EXISTING] Canvas styles
```

This architecture provides a clean separation between UI (page.tsx), visualization (GraphCanvas), and data (GraphQL), enabling maintainability and future enhancements.
